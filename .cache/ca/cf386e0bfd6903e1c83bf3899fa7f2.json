{"id":"node_modules/vega-transform-omnisci-core/build/vega-transform-omnisci-core.umd.js","dependencies":[{"name":"/Users/yangjunran/Desktop/github/sv-demo/node_modules/vega-transform-omnisci-core/build/vega-transform-omnisci-core.umd.js.map","includedInParent":true,"mtime":1620836215045},{"name":"/Users/yangjunran/Desktop/github/sv-demo/package.json","includedInParent":true,"mtime":1620836303330},{"name":"/Users/yangjunran/Desktop/github/sv-demo/node_modules/vega-transform-omnisci-core/package.json","includedInParent":true,"mtime":1620836215045},{"name":"vega","loc":{"line":1,"column":93},"parent":"/Users/yangjunran/Desktop/github/sv-demo/node_modules/vega-transform-omnisci-core/build/vega-transform-omnisci-core.umd.js","resolved":"/Users/yangjunran/Desktop/github/sv-demo/node_modules/vega/build/vega.module.js"}],"generated":{"js":"var define;\n!function(e,r){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=r(require(\"vega\")):\"function\"==typeof define&&define.amd?define([\"vega\"],r):(e||self).QueryCore=r(e.vega)}(this,function(e){function r(r){e.Transform.call(this,[],r)}return r.session=function(e){return e?(this._session=e,this):this._session},r.Definition={type:\"QueryCore\",metadata:{changes:!0,source:!0},params:[{name:\"query\",type:\"string\",required:!0}]},e.inherits(r,e.Transform).transform=function(s,n){try{var i=this;if(!r._session)throw Error(\"OmniSci Core session missing. Please assign it to the Vega transform by calling `QueryCore.session(session).`\");return n.dataflow.info(\"OmniSci Core Query: \"+s.query),Promise.resolve(r._session.queryAsync(s.query)).then(function(r){r.forEach(e.ingest);var s=n.fork(n.NO_FIELDS&n.NO_SOURCE);return s.rem=i.value,i.value=s.add=s.source=r,s})}catch(e){return Promise.reject(e)}},r});\n\n"},"sourceMaps":{"js":{"mappings":[{"source":"../index.js","name":"QueryCore","original":{"line":9,"column":24},"generated":{"line":2,"column":260}},{"source":"../index.js","name":"params","original":{"line":9,"column":34},"generated":{"line":2,"column":262}},{"source":"../index.js","name":"Transform","original":{"line":10,"column":2},"generated":{"line":2,"column":265}},{"source":"../index.js","name":"call","original":{"line":10,"column":12},"generated":{"line":2,"column":277}},{"source":"../index.js","name":"this","original":{"line":10,"column":17},"generated":{"line":2,"column":282}},{"source":"../index.js","name":null,"original":{"line":10,"column":23},"generated":{"line":2,"column":287}},{"source":"../index.js","name":"params","original":{"line":10,"column":27},"generated":{"line":2,"column":290}},{"source":"../index.js","name":"QueryCore","original":{"line":18,"column":0},"generated":{"line":2,"column":300}},{"source":"../index.js","name":"session","original":{"line":18,"column":10},"generated":{"line":2,"column":302}},{"source":"../index.js","name":null,"original":{"line":18,"column":20},"generated":{"line":2,"column":310}},{"source":"../index.js","name":"session","original":{"line":18,"column":29},"generated":{"line":2,"column":319}},{"source":"../index.js","name":null,"original":{"line":19,"column":2},"generated":{"line":2,"column":322}},{"source":"../index.js","name":"session","original":{"line":19,"column":6},"generated":{"line":2,"column":329}},{"source":"../index.js","name":"this","original":{"line":20,"column":4},"generated":{"line":2,"column":332}},{"source":"../index.js","name":"_session","original":{"line":20,"column":9},"generated":{"line":2,"column":337}},{"source":"../index.js","name":"session","original":{"line":20,"column":20},"generated":{"line":2,"column":346}},{"source":"../index.js","name":"_session","original":{"line":24,"column":14},"generated":{"line":2,"column":359}},{"source":"../index.js","name":"QueryCore","original":{"line":27,"column":0},"generated":{"line":2,"column":369}},{"source":"../index.js","name":"Definition","original":{"line":27,"column":10},"generated":{"line":2,"column":371}},{"source":"../index.js","name":null,"original":{"line":27,"column":23},"generated":{"line":2,"column":382}},{"source":"../index.js","name":"type","original":{"line":28,"column":2},"generated":{"line":2,"column":383}},{"source":"../index.js","name":null,"original":{"line":28,"column":8},"generated":{"line":2,"column":388}},{"source":"../index.js","name":"metadata","original":{"line":29,"column":2},"generated":{"line":2,"column":400}},{"source":"../index.js","name":null,"original":{"line":29,"column":12},"generated":{"line":2,"column":409}},{"source":"../index.js","name":"changes","original":{"line":29,"column":14},"generated":{"line":2,"column":410}},{"source":"../index.js","name":null,"original":{"line":29,"column":23},"generated":{"line":2,"column":419}},{"source":"../index.js","name":"source","original":{"line":29,"column":29},"generated":{"line":2,"column":421}},{"source":"../index.js","name":null,"original":{"line":29,"column":37},"generated":{"line":2,"column":429}},{"source":"../index.js","name":"params","original":{"line":30,"column":2},"generated":{"line":2,"column":432}},{"source":"../index.js","name":null,"original":{"line":30,"column":10},"generated":{"line":2,"column":439}},{"source":"../index.js","name":null,"original":{"line":30,"column":11},"generated":{"line":2,"column":440}},{"source":"../index.js","name":"name","original":{"line":30,"column":13},"generated":{"line":2,"column":441}},{"source":"../index.js","name":null,"original":{"line":30,"column":19},"generated":{"line":2,"column":446}},{"source":"../index.js","name":"type","original":{"line":30,"column":28},"generated":{"line":2,"column":454}},{"source":"../index.js","name":null,"original":{"line":30,"column":34},"generated":{"line":2,"column":459}},{"source":"../index.js","name":"required","original":{"line":30,"column":44},"generated":{"line":2,"column":468}},{"source":"../index.js","name":null,"original":{"line":30,"column":54},"generated":{"line":2,"column":478}},{"source":"../index.js","name":"inherits","original":{"line":33,"column":18},"generated":{"line":2,"column":483}},{"source":"../index.js","name":"QueryCore","original":{"line":33,"column":27},"generated":{"line":2,"column":494}},{"source":"../index.js","name":"Transform","original":{"line":33,"column":38},"generated":{"line":2,"column":496}},{"source":"../index.js","name":"transform","original":{"line":35,"column":10},"generated":{"line":2,"column":509}},{"source":"../index.js","name":"_","original":{"line":35,"column":37},"generated":{"line":2,"column":528}},{"source":"../index.js","name":"pulse","original":{"line":35,"column":40},"generated":{"line":2,"column":530}},{"source":"../index.js","name":"this","original":{"line":49,"column":12},"generated":{"line":2,"column":543}},{"source":"../index.js","name":null,"original":{"line":36,"column":2},"generated":{"line":2,"column":548}},{"source":"../index.js","name":"QueryCore","original":{"line":36,"column":7},"generated":{"line":2,"column":552}},{"source":"../index.js","name":"_session","original":{"line":36,"column":17},"generated":{"line":2,"column":554}},{"source":"../index.js","name":null,"original":{"line":37,"column":4},"generated":{"line":2,"column":563}},{"source":"../index.js","name":"Error","original":{"line":37,"column":10},"generated":{"line":2,"column":569}},{"source":"../index.js","name":null,"original":{"line":38,"column":6},"generated":{"line":2,"column":575}},{"source":"../index.js","name":null,"original":{"line":35,"column":47},"generated":{"line":2,"column":688}},{"source":"../index.js","name":"pulse","original":{"line":42,"column":2},"generated":{"line":2,"column":695}},{"source":"../index.js","name":"dataflow","original":{"line":42,"column":8},"generated":{"line":2,"column":697}},{"source":"../index.js","name":"info","original":{"line":42,"column":17},"generated":{"line":2,"column":706}},{"source":"../index.js","name":"_","original":{"line":42,"column":45},"generated":{"line":2,"column":734}},{"source":"../index.js","name":"query","original":{"line":42,"column":47},"generated":{"line":2,"column":736}},{"source":"../index.js","name":"QueryCore","original":{"line":44,"column":23},"generated":{"line":2,"column":759}},{"source":"../index.js","name":"_session","original":{"line":44,"column":33},"generated":{"line":2,"column":761}},{"source":"../index.js","name":"queryAsync","original":{"line":44,"column":42},"generated":{"line":2,"column":770}},{"source":"../index.js","name":"_","original":{"line":44,"column":53},"generated":{"line":2,"column":781}},{"source":"../index.js","name":"query","original":{"line":44,"column":55},"generated":{"line":2,"column":783}},{"source":"../index.js","name":"result","original":{"line":44,"column":8},"generated":{"line":2,"column":805}},{"source":"../index.js","name":"result","original":{"line":46,"column":2},"generated":{"line":2,"column":808}},{"source":"../index.js","name":"forEach","original":{"line":46,"column":9},"generated":{"line":2,"column":810}},{"source":"../index.js","name":"ingest","original":{"line":46,"column":17},"generated":{"line":2,"column":818}},{"source":"../index.js","name":null,"original":{"line":48,"column":2},"generated":{"line":2,"column":828}},{"source":"../index.js","name":"out","original":{"line":48,"column":8},"generated":{"line":2,"column":832}},{"source":"../index.js","name":"pulse","original":{"line":48,"column":14},"generated":{"line":2,"column":834}},{"source":"../index.js","name":"fork","original":{"line":48,"column":20},"generated":{"line":2,"column":836}},{"source":"../index.js","name":"pulse","original":{"line":48,"column":25},"generated":{"line":2,"column":841}},{"source":"../index.js","name":"NO_FIELDS","original":{"line":48,"column":31},"generated":{"line":2,"column":843}},{"source":"../index.js","name":"pulse","original":{"line":48,"column":43},"generated":{"line":2,"column":853}},{"source":"../index.js","name":"NO_SOURCE","original":{"line":48,"column":49},"generated":{"line":2,"column":855}},{"source":"../index.js","name":null,"original":{"line":52,"column":2},"generated":{"line":2,"column":866}},{"source":"../index.js","name":"out","original":{"line":49,"column":2},"generated":{"line":2,"column":873}},{"source":"../index.js","name":"rem","original":{"line":49,"column":6},"generated":{"line":2,"column":875}},{"source":"../index.js","name":"_this2","original":{"line":49,"column":12},"generated":{"line":2,"column":879}},{"source":"../index.js","name":"value","original":{"line":49,"column":17},"generated":{"line":2,"column":881}},{"source":"../index.js","name":"_this2","original":{"line":50,"column":2},"generated":{"line":2,"column":887}},{"source":"../index.js","name":"value","original":{"line":50,"column":7},"generated":{"line":2,"column":889}},{"source":"../index.js","name":"out","original":{"line":50,"column":15},"generated":{"line":2,"column":895}},{"source":"../index.js","name":"add","original":{"line":50,"column":19},"generated":{"line":2,"column":897}},{"source":"../index.js","name":"out","original":{"line":50,"column":25},"generated":{"line":2,"column":901}},{"source":"../index.js","name":"source","original":{"line":50,"column":29},"generated":{"line":2,"column":903}},{"source":"../index.js","name":"result","original":{"line":50,"column":38},"generated":{"line":2,"column":910}},{"source":"../index.js","name":"out","original":{"line":52,"column":9},"generated":{"line":2,"column":912}},{"source":"../index.js","name":null,"original":{"line":35,"column":0},"generated":{"line":2,"column":916}}],"sources":{"../index.js":"import { inherits, ingest, Transform } from \"vega\";\n\n/**\n * Generates a function to query data from an OmniSci Core database.\n * @constructor\n * @param {object} params - The parameters for this operator.\n * @param {function(object): *} params.query - The SQL query.\n */\nexport default function QueryCore(params) {\n  Transform.call(this, [], params);\n}\n\n/**\n * Set the OmniSci Core session.\n * \n * @param {*} session \n */\nQueryCore.session = function(session) {\n  if (session) {\n    this._session = session;\n    return this;\n  }\n\n  return this._session;\n};\n\nQueryCore.Definition = {\n  type: \"QueryCore\",\n  metadata: { changes: true, source: true },\n  params: [{ name: \"query\", type: \"string\", required: true }]\n};\n\nconst prototype = inherits(QueryCore, Transform);\n\nprototype.transform = async function(_, pulse) {\n  if (!QueryCore._session) {\n    throw Error(\n      \"OmniSci Core session missing. Please assign it to the Vega transform by calling `QueryCore.session(session).`\"\n    );\n  }\n\n  pulse.dataflow.info(`OmniSci Core Query: ${_.query}`);\n\n  const result = await QueryCore._session.queryAsync(_.query);\n\n  result.forEach(ingest);\n\n  const out = pulse.fork(pulse.NO_FIELDS & pulse.NO_SOURCE);\n  out.rem = this.value;\n  this.value = out.add = out.source = result;\n\n  return out;\n};\n"},"lineCount":null}},"error":null,"hash":"e26e161461b1d2801fdec95414732840","cacheData":{"env":{}}}